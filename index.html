<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–æ–µ–π —Å–Ω–µ–∂–∏–Ω–∫–µ ü§ç</title>

  <style>
    :root{
      /* ‚ùÑÔ∏è –±–µ–ª–æ—Å–Ω–µ–∂–Ω–∞—è —Ç–µ–º–∞ —Å —Ä–æ–∑–æ–≤—ã–º–∏ –æ—Ç—Ç–µ–Ω–∫–∞–º–∏ */
      --bg1:#ffffff;
      --bg2:#f7f3f8;

      --card: rgba(255,255,255,.86);
      --card2: rgba(255,255,255,.74);

      --text: rgba(25,25,35,.92);
      --muted: rgba(25,25,35,.70);

      --accent:#ff6fa1;
      --accent2:#ffb7cf;
      --accent3:#ffe3ec;

      --shadow: 0 18px 60px rgba(0,0,0,.12);
      --radius: 22px;
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100dvh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 12% 8%, rgba(255,111,161,.18), transparent 60%),
        radial-gradient(900px 520px at 86% 18%, rgba(255,183,207,.18), transparent 58%),
        radial-gradient(900px 520px at 50% 112%, rgba(255,227,236,.30), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding: 18px;
      overflow:hidden;
    }

    #bgCanvas{ position:fixed; inset:0; pointer-events:none; z-index:0; }
    #fxCanvas{ position:fixed; inset:0; pointer-events:none; z-index:10; }

    .app{ width:min(780px,100%); position:relative; z-index:2; }

    .book{
      width:100%;
      height: min(780px, calc(100dvh - 36px));
      border-radius: var(--radius);
      border: 1px solid rgba(0,0,0,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.60));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      backdrop-filter: blur(10px);
    }

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(0,0,0,.07);
      background: rgba(255,255,255,.58);
      backdrop-filter: blur(10px);
    }
    .badge{ display:inline-flex; gap:8px; align-items:center; font-size: 13px; color: rgba(25,25,35,.70); }
    .dot{ width:8px;height:8px;border-radius:999px; background: var(--accent); box-shadow: 0 0 16px rgba(255,111,161,.35); }
    .pill{ height:8px; width:170px; border-radius:999px; background: rgba(0,0,0,.06); overflow:hidden; }
    .pill > i{ display:block;height:100%; width:0%; background: linear-gradient(90deg, var(--accent), var(--accent2), var(--accent3)); }

    .stage{
      position:relative;
      height: calc(100% - 58px);
      padding: 18px;
      overflow:hidden;
    }

    .pageShell{
      width:min(720px,100%);
      height:100%;
      margin:0 auto;
      position:relative;
      border-radius: calc(var(--radius) - 6px);
      border: 1px solid rgba(0,0,0,.07);
      background: linear-gradient(180deg, var(--card), var(--card2));
      box-shadow: 0 12px 40px rgba(0,0,0,.10);
      overflow:hidden;
    }

    .page{
      position:absolute;
      inset:0;
      padding:22px;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      opacity:0;
      transform: translateX(18px);
      pointer-events:none;
    }

    .page.active{
      opacity:1;
      transform: translateX(0);
      pointer-events:auto;
      transition: opacity .55s ease, transform .55s ease;
    }

    .page.exitLeft{
      opacity:0;
      transform: translateX(-18px);
      transition: opacity .55s ease, transform .55s ease;
      pointer-events:none;
    }
    .page.exitRight{
      opacity:0;
      transform: translateX(18px);
      transition: opacity .55s ease, transform .55s ease;
      pointer-events:none;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ + —Ñ–æ–ª–±—ç–∫ —Ü–≤–µ—Ç–∞ */
    h1,h2{ margin:0 0 10px 0; letter-spacing:.2px; line-height:1.15; }
    h1{
      font-size: clamp(28px, 3.6vw, 46px);
      color: rgba(25,25,35,.96);
      text-shadow: 0 12px 40px rgba(255,111,161,.10);
    }
    h2{
      font-size: clamp(22px, 2.8vw, 32px);
      color: rgba(255,111,161,.96);
    }

    /* –ì—Ä–∞–¥–∏–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞ ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è */
    @supports (-webkit-background-clip: text) and (-webkit-text-fill-color: transparent) {
      h1{
        background: linear-gradient(90deg, rgba(25,25,35,.96), var(--accent2), var(--accent));
        -webkit-background-clip:text;
        background-clip:text;
        -webkit-text-fill-color: transparent;
        color: transparent;
      }
      h2{
        background: linear-gradient(90deg, var(--accent), rgba(25,25,35,.90), var(--accent2));
        -webkit-background-clip:text;
        background-clip:text;
        -webkit-text-fill-color: transparent;
        color: transparent;
      }
    }

    p{ margin:10px 0; line-height:1.65; color:var(--muted); font-size:16px; }

    .hero{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      align-items:center;
    }
    @media (max-width:700px){ .hero{ grid-template-columns:1fr; } }

    .photo{
      aspect-ratio:4/3;
      border-radius:18px;
      border:1px solid rgba(0,0,0,.08);
      overflow:hidden;
      background:
        radial-gradient(160px 160px at 18% 20%, rgba(255,111,161,.18), transparent 60%),
        radial-gradient(160px 160px at 80% 30%, rgba(255,227,236,.32), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.70), rgba(255,255,255,.30));
      display:flex; align-items:center; justify-content:center;
      color: rgba(25,25,35,.70);
      font-size:14px;
      text-align:center;
      padding:10px;
    }
    .photo img{ width:100%; height:100%; object-fit:cover; display:block; }

    .controls{
      display:flex;
      gap:10px;
      justify-content:space-between;
      margin-top:16px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.62);
      color: rgba(25,25,35,.90);
      padding:12px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      letter-spacing:.2px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 10px 30px rgba(0,0,0,.10);
      display:inline-flex; align-items:center; gap:8px;
      backdrop-filter: blur(8px);
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(90deg, rgba(255,111,161,.95), rgba(255,183,207,.92), rgba(255,227,236,.88));
      border-color: rgba(0,0,0,.06);
      color:#221226;
    }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }

    /* –º—É–∑—ã–∫–∞ */
    .music-chip{
      position:fixed;
      left:14px;
      bottom:14px;
      z-index:99999;
      display:none;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.70);
      backdrop-filter: blur(10px);
      color: rgba(25,25,35,.92);
      font-weight:900;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 10px 30px rgba(0,0,0,.10);
    }
    .music-chip.show{ display:inline-flex; }

    /* ‚úÖ –ø—Ä–∏—á–∏–Ω—ã –ø–æ —Ü–µ–Ω—Ç—Ä—É (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ 2) */
    .reasons{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin: 14px 0 0 0;
      padding:0;
      list-style:none;
      align-items:center;
      text-align:center;
    }
    .reason{
      width:min(560px, 100%);
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.60);
      box-shadow: 0 10px 26px rgba(0,0,0,.06);
      color: rgba(25,25,35,.86);
      line-height:1.55;
    }

    /* ‚úÖ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 3 ‚Äî –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç (–±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞) */
    .snowText{
      margin-top: 8px;
      text-align:center;
      font-size: clamp(18px, 3.0vw, 28px);
      line-height:1.55;
      font-weight:900;
      color: rgba(25,25,35,.90); /* —Ñ–æ–ª–±—ç–∫ */
      text-shadow: 0 10px 22px rgba(255,111,161,.10);
      padding: 6px 6px;
    }
    @supports (-webkit-background-clip: text) and (-webkit-text-fill-color: transparent) {
      .snowText{
        background: linear-gradient(90deg, rgba(25,25,35,.95), var(--accent), var(--accent2));
        -webkit-background-clip:text;
        background-clip:text;
        -webkit-text-fill-color: transparent;
        color: transparent;
      }
    }

    @media (max-width:360px){
      .pill{ width:135px; }
      .page{ padding:18px; }
    }
  </style>
</head>

<body>
  <canvas id="bgCanvas"></canvas>
  <canvas id="fxCanvas"></canvas>

  <audio id="bgm" src="song.mp3" preload="auto" loop></audio>
  <button class="music-chip" id="musicChip">üéµ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É</button>

  <main class="app">
    <section class="book">
      <div class="topbar">
        <div class="badge"><span class="dot"></span><span id="counter">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 5</span></div>
        <span class="pill"><i id="bar"></i></span>
      </div>

      <div class="stage">
        <div class="pageShell">

          <!-- 1 -->
          <section class="page" data-i="0">
            <div class="hero">
              <div>
                <h1>–ú–æ–µ–π —Å–Ω–µ–∂–∏–Ω–∫–µ ü§ç</h1>
                <p>
                  –Ø —Å–¥–µ–ª–∞–ª —ç—Ç–æ—Ç –º–∞–ª–µ–Ω—å–∫–∏–π —Å–∞–π—Ç, —á—Ç–æ–±—ã —Ç—ã –º–æ–≥–ª–∞ –ª–∏—Å—Ç–∞—Ç—å –µ–≥–æ –∫–∞–∫ –∫–Ω–∏–≥—É.
                  –¢—É—Ç ‚Äî –º–æ–∏ —á—É–≤—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–æ–≥–¥–∞ —Å–ª–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å –≤—Å–ª—É—Ö, –Ω–æ –æ—á–µ–Ω—å –ª–µ–≥–∫–æ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π.
                </p>
                <p>‚ùÑÔ∏èü§ç‚ú®</p>
              </div>
              <div class="photo">
                <img src="lera.jpg" alt="–õ–µ—Ä–∞">
              </div>
            </div>

            <div class="controls">
              <button class="btn" id="prevBtn" disabled>‚Üê –ù–∞–∑–∞–¥</button>
              <button class="btn primary" id="nextBtn">–î–∞–ª—å—à–µ ‚Üí</button>
            </div>
          </section>

          <!-- 2 -->
          <section class="page" data-i="1">
            <h2>–ó–∞ —á—Ç–æ —è —Ç–µ–±—è –ª—é–±–ª—é</h2>
            <p>–ï—Å–ª–∏ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏—á–∏–Ω (—Ö–æ—Ç—è –∏—Ö –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ):</p>

            <div class="reasons" role="list">
              <div class="reason" role="listitem">—Ç—ã —É–º–µ–µ—à—å –¥–µ–ª–∞—Ç—å –¥–∞–∂–µ –æ–±—ã—á–Ω—ã–µ –¥–Ω–∏ —Ç—ë–ø–ª—ã–º–∏ ‚ùÑÔ∏è</div>
              <div class="reason" role="listitem">—Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è –±—ã—Ç—å –ª—É—á—à–µ ‚Äî –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è, –ø—Ä–æ—Å—Ç–æ –ø–æ –ª—é–±–≤–∏ ü§ç</div>
              <div class="reason" role="listitem">–º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, —Ç–≤–æ–π —Å–º–µ—Ö –∏ —Ç–æ, –∫–∞–∫ —Ç—ã —Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ –º–∏—Ä ‚ú®</div>
              <div class="reason" role="listitem">—Ç—ã –Ω–∞—Å—Ç–æ—è—â–∞—è ‚Äî –∏ —ç—Ç–æ –±–µ—Å—Ü–µ–Ω–Ω–æ</div>
            </div>

            <div class="controls">
              <button class="btn" data-prev>‚Üê –ù–∞–∑–∞–¥</button>
              <button class="btn primary" data-next>–î–∞–ª—å—à–µ ‚Üí</button>
            </div>
          </section>

          <!-- 3 -->
          <section class="page" data-i="2">
            <div class="snowText">
              –í –º–∏—Ä–µ, –≥–¥–µ —Ç–∞–∫ –º–Ω–æ–≥–æ –∏–∑–º–µ–Ω, —Ä–∞–∑–≤–æ–¥–æ–≤ –∏ –∑–ª–∞, –¥–∞–≤–∞–π –æ—Å—Ç–∞–Ω–µ–º—Å—è –¥—Ä—É–≥ –¥–ª—è –¥—Ä—É–≥–∞ –≤–µ—Ä–Ω—ã–º–∏, –ª—é–±–∏–º—ã–º–∏ –∏ –∏—Å–∫—Ä–µ–Ω–Ω–∏–º–∏ –ª—é–¥—å–º–∏
            </div>

            <div class="controls">
              <button class="btn" data-prev>‚Üê –ù–∞–∑–∞–¥</button>
              <button class="btn primary" data-next>–î–∞–ª—å—à–µ ‚Üí</button>
            </div>
          </section>

          <!-- 4 -->
          <section class="page" data-i="3">
            <h2>–ü–∏—Å—å–º–æ –¥–ª—è —Ç–µ–±—è</h2>
            <p>
              –ò–Ω–æ–≥–¥–∞ –º–Ω–µ —Ö–æ—á–µ—Ç—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –ø–æ–¥–æ–ª—å—à–µ –ø–æ–±—ã—Ç—å —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π ‚Äî –≤ —Ç–≤–æ—ë–º —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–∏, –≤ —Ç–≤–æ–µ–π —É–ª—ã–±–∫–µ,
              –≤ —Ç–≤–æ–∏—Ö –≥–ª–∞–∑–∞—Ö. –¢—ã —É–º–µ–µ—à—å –¥–µ–ª–∞—Ç—å –º–∏—Ä –º—è–≥—á–µ, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –≤–æ–∫—Ä—É–≥ —à—É–º–Ω–æ.
            </p>
            <p>
              –Ø —Ö–æ—á—É –±–µ—Ä–µ—á—å —Ç–µ–±—è ‚Äî –Ω–µ –≥—Ä–æ–º–∫–∏–º–∏ –æ–±–µ—â–∞–Ω–∏—è–º–∏, –∞ –¥–µ–ª–∞–º–∏: –≤–Ω–∏–º–∞–Ω–∏–µ–º, –∑–∞–±–æ—Ç–æ–π, —Ç–µ–ø–ª–æ–º.
              –ß—Ç–æ–±—ã —Ç—ã –≤—Å–µ–≥–¥–∞ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞: —Ç—ã –ª—é–±–∏–º–∞, —Ç—ã –≤–∞–∂–Ω–∞, —Ç—ã ‚Äî –º–æ—è —Å–∞–º–∞—è –Ω–∞—Å—Ç–æ—è—â–∞—è —Ä–∞–¥–æ—Å—Ç—å. ü§ç
            </p>

            <div class="controls">
              <button class="btn" data-prev>‚Üê –ù–∞–∑–∞–¥</button>
              <button class="btn primary" data-next>–î–∞–ª—å—à–µ ‚Üí</button>
            </div>
          </section>

          <!-- 5 -->
          <section class="page" data-i="4">
            <h2>–ò –Ω–∞–ø–æ—Å–ª–µ–¥–æ–∫‚Ä¶</h2>
            <p>
              –Ø —Ö–æ—á—É, —á—Ç–æ–±—ã —É –Ω–∞—Å –±—ã–ª–æ –µ—â—ë –º–Ω–æ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî —É–∂–µ –Ω–µ –Ω–∞ —Å–∞–π—Ç–µ, –∞ –≤ –∂–∏–∑–Ω–∏:
              —Ç—ë–ø–ª—ã—Ö, —Å–º–µ—à–Ω—ã—Ö, –≤–∞–∂–Ω—ã—Ö, –Ω–∞—Å—Ç–æ—è—â–∏—Ö. ü§ç
            </p>

            <div class="controls">
              <button class="btn" data-prev>‚Üê –ù–∞–∑–∞–¥</button>
              <button class="btn primary" id="surpriseBtn">–°—é—Ä–ø—Ä–∏–∑ ‚ú®</button>
            </div>
          </section>

        </div>
      </div>
    </section>
  </main>

  <script>
    /* ========= —Å—Ç—Ä–∞–Ω–∏—Ü—ã: –æ–±—ã—á–Ω–æ–µ –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–µ ========= */
    const pages = Array.from(document.querySelectorAll(".page"));
    const counter = document.getElementById("counter");
    const bar = document.getElementById("bar");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    let idx = 0;
    let lock = false;

    function setUI(){
      counter.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${idx+1} –∏–∑ ${pages.length}`;
      bar.style.width = Math.round(((idx+1)/pages.length)*100) + "%";
      if(prevBtn && nextBtn){
        prevBtn.disabled = idx === 0;
        nextBtn.textContent = (idx === pages.length-1) ? "–§–∏–Ω–∞–ª ‚Üí" : "–î–∞–ª—å—à–µ ‚Üí";
      }
    }

    function show(i, dir){
      pages.forEach(p => p.className = "page");
      const current = pages[idx];
      const next = pages[i];

      if(dir === 1) current.classList.add("exitLeft");
      if(dir === -1) current.classList.add("exitRight");

      next.classList.add("active");
      next.scrollTop = 0;

      idx = i;
      setUI();
    }

    function goNext(){
      if(lock || idx >= pages.length-1) return;
      lock = true;
      sprinkleFX(12); // ‚ùÑÔ∏è —Å–Ω–µ–∂–∏–Ω–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ
      show(idx+1, 1);
      setTimeout(()=> lock=false, 560);
    }
    function goPrev(){
      if(lock || idx <= 0) return;
      lock = true;
      sprinkleFX(12); // ‚ùÑÔ∏è —Å–Ω–µ–∂–∏–Ω–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ
      show(idx-1, -1);
      setTimeout(()=> lock=false, 560);
    }

    document.addEventListener("click", (e) => {
      const t = e.target;
      if(t.matches("[data-next]") || t === nextBtn) goNext();
      if(t.matches("[data-prev]") || t === prevBtn) goPrev();
    });
    if(prevBtn) prevBtn.addEventListener("click", goPrev);
    if(nextBtn) nextBtn.addEventListener("click", goNext);

    pages[0].classList.add("active");
    setUI();

    /* ========= —Ñ–æ–Ω/—ç—Ñ—Ñ–µ–∫—Ç—ã: —Å–Ω–µ–∂–∏–Ω–∫–∏, –º–µ–¥–ª–µ–Ω–Ω–µ–µ ========= */
    const bgCanvas = document.getElementById("bgCanvas");
    const fxCanvas = document.getElementById("fxCanvas");
    const bg = bgCanvas.getContext("2d");
    const fx = fxCanvas.getContext("2d");

    function resize(c, ctx){
      c.width = Math.floor(window.innerWidth * devicePixelRatio);
      c.height = Math.floor(window.innerHeight * devicePixelRatio);
      c.style.width = window.innerWidth + "px";
      c.style.height = window.innerHeight + "px";
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    function resizeAll(){ resize(bgCanvas, bg); resize(fxCanvas, fx); }
    window.addEventListener("resize", resizeAll);
    resizeAll();

    const bgParts = [];
    const fxParts = [];

    // ‚ùÑÔ∏è —Å–Ω–µ–∂–∏–Ω–∫–∏ –≤–º–µ—Å—Ç–æ —Ü–≤–µ—Ç–æ–≤
    const bgSyms = ["‚ùÑÔ∏è","‚ùÖ","‚ùÜ","‚ú®","ü§ç"];
    const fxSyms = ["‚ùÑÔ∏è","‚ùÑÔ∏è","‚ùÖ","‚ú®","ü§ç"]; // –±–æ–ª—å—à–µ —Å–Ω–µ–∂–∏–Ω–æ–∫

    function add(arr, p){
      if(arr === bgParts && bgParts.length > 95) return;
      if(arr === fxParts && fxParts.length > 140) return;
      arr.push(p);
    }

    function spawnBG(n=1){
      const w = window.innerWidth;
      for(let i=0;i<n;i++){
        const sym = bgSyms[(Math.random()*bgSyms.length)|0];
        add(bgParts,{
          x: Math.random()*w,
          y: -80 - Math.random()*120,
          vx: (Math.random()*0.20 - 0.10),     // –º–µ–¥–ª–µ–Ω–Ω–µ–µ –≤–±–æ–∫
          vy: 0.25 + Math.random()*0.55,       // –º–µ–¥–ª–µ–Ω–Ω–µ–µ –≤–Ω–∏–∑
          g: 0.001 + Math.random()*0.003,      // –º–µ–Ω—å—à–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ
          size: 14 + Math.random()*14,
          a: 0.20 + Math.random()*0.18,
          da: 0.00045 + Math.random()*0.00055,
          rot: Math.random()*Math.PI*2,
          dr: (Math.random()*0.014 - 0.007),
          sym
        });
      }
    }

    function sprinkleFX(n=12){
      const w = window.innerWidth;
      for(let i=0;i<n;i++){
        const sym = fxSyms[(Math.random()*fxSyms.length)|0];
        add(fxParts,{
          x: Math.random()*w,
          y: -35 - Math.random()*60,
          vx: (Math.random()*0.50 - 0.25),
          vy: 0.55 + Math.random()*0.90,       // —Ç–æ–∂–µ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –∑–∞–º–µ—Ç–Ω–æ
          g: 0.010 + Math.random()*0.015,
          size: 18 + Math.random()*14,
          a: 0.90,
          da: 0.010 + Math.random()*0.010,
          rot: Math.random()*Math.PI*2,
          dr: (Math.random()*0.06 - 0.03),
          sym
        });
      }
    }

    let surpriseLock = false;
    function burstFX(){
      if(surpriseLock) return;
      surpriseLock = true;
      setTimeout(() => surpriseLock = false, 1500);

      const w = window.innerWidth, h = window.innerHeight;
      const COUNT = 50;
      for(let i=0;i<COUNT;i++){
        const sym = ["‚ú®","ü§ç","‚ùÑÔ∏è","‚ùÖ"][(Math.random()*4)|0];
        const x = Math.random()*w;
        const y = Math.random()*h;
        const ang = Math.random()*Math.PI*2;
        const sp = 1.4 + Math.random()*2.2;

        add(fxParts,{
          x,y,
          vx: Math.cos(ang)*sp,
          vy: Math.sin(ang)*sp - 0.6,
          g: 0.035 + Math.random()*0.05,
          size: 18 + Math.random()*18,
          a: 1,
          da: 0.012 + Math.random()*0.012,
          rot: Math.random()*Math.PI*2,
          dr: (Math.random()*0.10 - 0.05),
          sym
        });
      }
    }

    function step(ctx, arr){
      for(let i=arr.length-1;i>=0;i--){
        const p = arr[i];
        p.vy += p.g;
        p.x += p.vx;
        p.y += p.vy;
        p.vx *= 0.996;
        p.vy *= 0.996;
        p.rot += p.dr;
        p.a -= p.da;

        ctx.save();
        ctx.globalAlpha = Math.max(0, p.a);
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.font = `${p.size}px system-ui, Apple Color Emoji, Segoe UI Emoji`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(p.sym, 0, 0);
        ctx.restore();

        const out = (p.y > window.innerHeight + 140 || p.x < -180 || p.x > window.innerWidth + 180);
        if(p.a <= 0 || out) arr.splice(i,1);
      }
    }

    function loop(){
      bg.clearRect(0,0,window.innerWidth, window.innerHeight);
      fx.clearRect(0,0,window.innerWidth, window.innerHeight);
      step(bg, bgParts);
      step(fx, fxParts);
      requestAnimationFrame(loop);
    }
    loop();

    spawnBG(18);
    setInterval(() => spawnBG(1), 450); // –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ

    const surpriseBtn = document.getElementById("surpriseBtn");
    if(surpriseBtn) surpriseBtn.addEventListener("click", burstFX);

    /* ========= –º—É–∑—ã–∫–∞ ========= */
    const bgm = document.getElementById("bgm");
    const musicChip = document.getElementById("musicChip");

    async function tryAutoplay(){
      try{
        bgm.volume = 0.85;
        await bgm.play();
        musicChip.classList.remove("show");
      }catch(e){
        musicChip.classList.add("show");
      }
    }
    window.addEventListener("load", tryAutoplay);
    const once = () => { tryAutoplay(); window.removeEventListener("pointerdown", once); };
    window.addEventListener("pointerdown", once, {passive:true});
    musicChip.addEventListener("click", async () => {
      try{ await bgm.play(); musicChip.classList.remove("show"); }catch(e){}
    });
  </script>
</body>
</html>